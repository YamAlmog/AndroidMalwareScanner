import os
from dataset_builder import DatasetBuilder
from errors import ApkAnalyzerError
from dotenv import load_dotenv

if os.getenv("DOCKER_ENV"):
    load_dotenv(".docker.env")
else:
    load_dotenv(".env")

df_builder = DatasetBuilder()


def main():

    malicious_files_dir = os.getenv("MALICIOUS_FILES_DIR")
    benign_files_dir = os.getenv("BENIGN_FILES_DIR")
    benign_test_files_dir = os.getenv("BENIGN_TEST_FILES_DIR")
    malicious_test_file_dir = os.getenv("MALICIOUS_TEST_FILES_DIR")
    common_permission_file_path = os.getenv("COMMON_PERMISSIONS_PATH_FROM_SRC")
    try:
        df_builder.build_dataset(
            malicious_files_dir,
            benign_files_dir,
            common_permission_file_path,
            os.getenv("CSV_PATH_FROM_SRC"),
        )

        df_builder.build_test_set(
            benign_test_files_dir,
            malicious_test_file_dir,
            common_permission_file_path,
            os.getenv("TEST_DATAFRAME"),
        )
    except ApkAnalyzerError as e:
        print(e)
    except Exception as e:
        print(e)


if __name__ == "__main__":
    main()
