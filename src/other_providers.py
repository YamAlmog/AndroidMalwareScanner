from errors import OtherProvidersException
import json
import requests


class OtherProviders:
   
    def scan_with_virustotal(url:str, params:json):
        try:
            response = requests.get(url, params=params)
            if response.status_code == 200:
                report = response.json()
                if report['positives'] > 0:
                    return 'Malicious'
                else:
                    return 'Benign'
            else:
                raise requests.RequestException(f"status code: {response.status_code}")
        
        except Exception as e:
            raise OtherProvidersException(f"Error occurred while try to scan the file with Virus Total: {e}")
        
    
    def scan_with_scanii(file_content:bytes, api_key:str, api_url:str, api_secret:str):
        try:    
            # specify the file content type for apk
            file_type = "application/vnd.android.package-archive"

            # the POST request with the file parameter
            response = requests.post(api_url, auth=(api_key, api_secret), files={"file": (None, file_content, file_type)})
            
            findings = response.json()["findings"]
            print(findings)
            if len(findings) == 0:
                return 'Benign'
            else: 
                return 'Malicious'
    
        except Exception as e:
            raise OtherProvidersException(f"Error occurred while try to scan the file with Scanii: {e}")